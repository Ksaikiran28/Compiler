<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="codemirror-5.65.19/lib/codemirror.css"/>
  <script src="codemirror-5.65.19/lib/codemirror.js"></script>
  <script src="codemirror-5.65.19/mode/clike/clike.js"></script>
  <script src="codemirror-5.65.19/mode/python/python.js"></script>
  <link rel="stylesheet" href="codemirror-5.65.19/theme/dracula.css"/>
  <script src="codemirror-5.65.19/addon/edit/closebrackets.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
</head>
<body>
  <div class="row m-3">
    <div class="col">
      <div class="d-flex justify-content-between mb-2 bg-dark rounded p-2">
        <div class="col-12 w-25 ">
          <select class="form-select" id="inlineFormSelectPref">
            <option selected>Choose...</option>
            <option value="Java">Java</option>
            <option value="Python">Python</option>
            <option value="Cpp">Cpp</option>
          </select>
        </div>
        <div id="sprint-timer" class="text-center fs-4 fw-bold text-white bg-success rounded p-2 my-3 w-25 mx-auto"></div>
        <div>
          <button type="button" id="sprint-btn" class="btn btn-success">Coding Sprint</button>
          <button type="button" id="Run" class="btn btn-success"><i class="bi bi-play-fill"></i></button>
        </div>
      </div>
      <textarea class="form-control" id="editor"></textarea>
    </div>
    <div class="col d-flex flex-column rounded bg-dark px-4">
      <div class="h-50">
        <label class="text-light mt-4 mb-2">Input</label>
        <textarea id="input" class="form-control h-75"></textarea>
      </div>
      <div class="h-50">
        <label class="text-light mb-2">Output</label>
        <textarea id="output" class="form-control h-75"></textarea>
      </div>
    </div>
  </div>

  <script>
    var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
      mode: "text/x-c++src",
      theme: "dracula",
      lineNumbers: true,
      autoCloseBrackets: true,
    });

    var width = window.innerWidth;
    editor.setSize(0.7 * width, "80vh");

    var input = document.getElementById("input");
    var output = document.getElementById("output");
    var run = document.getElementById("Run");
    var option = document.getElementById("inlineFormSelectPref");

    const langMap = {
      "Cpp": 54,      
      "Java": 62,     
      "Python": 71    
    };

    option.addEventListener("change", function () {
      if (option.value == "Java") {
        editor.setOption("mode", "text/x-java");
      } else if (option.value == "Python") {
        editor.setOption("mode", "text/x-python");
      } else {
        editor.setOption("mode", "text/x-c++src");
      }
    });

    run.addEventListener("click", async function () {
      const langId = langMap[option.value];
      if (!langId) {
        alert("Please select a language");
        return;
      }

      const code = editor.getValue();
      const userInput = input.value;
      output.value = "Running...";

      run.disabled = true;

      try {
        const submissionRes = await fetch("https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=false&wait=true", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-RapidAPI-Host": "judge0-ce.p.rapidapi.com",
            "X-RapidAPI-Key": "3923cef974msh92e017bcad740edp15f7fcjsn7edcd4cfba35" // üî¥ Replace with your actual API key
          },
          body: JSON.stringify({
            source_code: code,
            stdin: userInput,
            language_id: langId
          })
        });

        const result = await submissionRes.json();
        output.value = result.stderr || result.compile_output || result.stdout || "No output";
      } catch (err) {
        output.value = "Error connecting to Judge0 API.";
        console.error(err);
      }

      run.disabled = false;
    });
    let sprintBtn=document.getElementById("sprint-btn");
    let timerDisplay = document.getElementById("sprint-timer");
    let timerInterval;
    sprintBtn.addEventListener("click",()=>{
      alert("‚è±Ô∏è 25-minute Coding Sprint started! Stay focused and avoid distractions.");
      let timeLeft=25*60;
      clearInterval(timerInterval);

      function updateTimer(){
        const minutes = Math.floor(timeLeft/60).toString().padStart(2,'0');
        const seconds =(timeLeft%60).toString().padStart(2,'0');
        timerDisplay.textContent=`‚è≥ ${minutes}:${seconds} remaining`;

        if(timeLeft<=0){
          clearInterval(timerInterval);
          timerDisplay.textContent="‚úÖ Sprint complete!";
        }
        timeLeft--;
      }
      updateTimer();
      timerInterval=setInterval(updateTimer,1000);
    })
  </script>
</body>
</html>
