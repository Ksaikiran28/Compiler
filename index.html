<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Code Editor</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>

  <link rel="stylesheet" href="codemirror-5.65.19/lib/codemirror.css"/>
  <link rel="stylesheet" href="codemirror-5.65.19/theme/dracula.css"/>
  <link rel="stylesheet" href="codemirror-5.65.19/addon/hint/show-hint.css"/>
  <script src="codemirror-5.65.19/lib/codemirror.js"></script>
  <script src="codemirror-5.65.19/mode/clike/clike.js"></script>
  <script src="codemirror-5.65.19/mode/python/python.js"></script>
  <script src="codemirror-5.65.19/mode/sql/sql.js"></script>
  <script src="codemirror-5.65.19/addon/edit/closebrackets.js"></script>
  <script src="codemirror-5.65.19/addon/edit/matchtags.js"></script>
  <script src="codemirror-5.65.19/addon/edit/closetag.js"></script>
  <script src="codemirror-5.65.19/addon/fold/xml-fold.js"></script>
  <script src="codemirror-5.65.19/addon/hint/show-hint.js"></script>
  <script src="codemirror-5.65.19/addon/hint/anyword-hint.js"></script>

  <style>
    .CodeMirror.placeholder-code .CodeMirror-code {
      opacity: 0.2;
      transition: opacity 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="row m-3">
    <div class="col">
      <div class="d-flex justify-content-between mb-2 bg-dark rounded p-2">
        <div class="col-12 w-25 pt-3">
          <select class="form-select" id="languageSelect">
            <option selected>Choose...</option>
            <option value="cpp">C++</option>
            <option value="java">Java</option>
            <option value="python">Python</option>
            <option value="sql">SQL</option>
          </select>
        </div>
        <div id="sprint-timer" class="text-center fs-4 fw-bold text-white bg-success rounded p-1 my-3 w-25 mx-auto">00:00</div>
        <div>
          <button id="sprint-btn" class="btn btn-success mt-3">Start Timer</button>
          <button id="pause-btn" class="btn btn-warning mt-3" style="display: none;">Pause</button>
          <button id="stop-btn" class="btn btn-danger mt-3" style="display: none;">Stop</button>
          <button id="Run" class="btn btn-success mt-3"><i class="bi bi-play-fill"></i></button>
        </div>
      </div>
      <textarea class="form-control" id="editor"></textarea>
    </div>
    <div class="col d-flex flex-column rounded bg-dark px-4">
      <div class="h-50">
        <label class="text-light mt-4 mb-2">Input</label>
        <textarea id="input" class="form-control h-75"></textarea>
      </div>
      <div class="h-50">
        <label class="text-light mb-2">Output</label>
        <textarea id="output" class="form-control h-75" readonly></textarea>
      </div>
    </div>
  </div>

  <script>
    const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
      mode: "text/x-c++src",
      theme: "dracula",
      lineNumbers: true,
      autoCloseBrackets: true,
      matchTags: { bothTags: true },
      autoCloseTags: true,
      extraKeys: { "Ctrl-Space": "autocomplete" }
    });

    editor.setSize(window.innerWidth * 0.7, "80vh");
    editor.on("beforeChange", () => {
      editor.getWrapperElement().classList.remove("placeholder-code");
    });

    const input = document.getElementById("input");
    const output = document.getElementById("output");
    const runBtn = document.getElementById("Run");
    const languageSelect = document.getElementById("languageSelect");

    const langMap = {
      "cpp": 54,
      "java": 62,
      "python": 71,
      "sql": 82
    };

    const helloTemplates = {
      "cpp": `#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}`,
      "java": `public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}`,
      "python": `print("Hello, World!")`,
      "sql": `SELECT 'Hello, World!';`
    };

    const modeMap = {
      "cpp": "text/x-c++src",
      "java": "text/x-java",
      "python": "text/x-python",
      "sql": "text/x-sql"
    };

    languageSelect.addEventListener("change", function () {
      const lang = languageSelect.value;

      if (editor.getValue().trim() !== "") {
        const confirmSwitch = confirm("Switching language will replace your current code. Continue?");
        if (!confirmSwitch) return;
      }

      editor.setOption("mode", modeMap[lang] || "text/plain");
      editor.setValue(helloTemplates[lang] || "");
      editor.getWrapperElement().classList.add("placeholder-code");
    });

    runBtn.addEventListener("click", async () => {
      const selectedLang = languageSelect.value;
      const langId = langMap[selectedLang];

      if (!langId) {
        alert("Please select a supported language");
        return;
      }

      const code = editor.getValue();
      const userInput = input.value;
      output.value = "Running...";
      runBtn.disabled = true;

      try {
        const res = await fetch("https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=false&wait=true", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-RapidAPI-Host": "judge0-ce.p.rapidapi.com",
            "X-RapidAPI-Key": "3923cef974msh92e017bcad740edp15f7fcjsn7edcd4cfba35"
          },
          body: JSON.stringify({
            source_code: code,
            stdin: userInput,
            language_id: langId
          })
        });

        const result = await res.json();
        output.value = result.stderr || result.compile_output || result.stdout || "No output.";
      } catch (error) {
        output.value = "Error connecting to Judge0 API.";
        console.error(error);
      }

      runBtn.disabled = false;
    });

    // Timer logic
    const sprintBtn = document.getElementById("sprint-btn");
    const pauseBtn = document.getElementById("pause-btn");
    const stopBtn = document.getElementById("stop-btn");
    const timerDisplay = document.getElementById("sprint-timer");

    let timerInterval;
    let elapsedTime = 0;
    let isPaused = false;

    function updateStopwatch() {
      const mins = String(Math.floor(elapsedTime / 60)).padStart(2, '0');
      const secs = String(elapsedTime % 60).padStart(2, '0');
      timerDisplay.textContent = `${mins}:${secs}`;
      elapsedTime++;
    }

    sprintBtn.addEventListener("click", () => {
      alert("Timer started! Time to focus!");
      clearInterval(timerInterval);
      elapsedTime = 0;
      isPaused = false;
      updateStopwatch();
      timerInterval = setInterval(updateStopwatch, 1000);

      pauseBtn.style.display = "inline-block";
      stopBtn.style.display = "inline-block";
      pauseBtn.textContent = "Pause";
    });

    pauseBtn.addEventListener("click", () => {
      if (isPaused) {
        timerInterval = setInterval(updateStopwatch, 1000);
        pauseBtn.textContent = "Pause";
      } else {
        clearInterval(timerInterval);
        pauseBtn.textContent = "Resume";
      }
      isPaused = !isPaused;
    });

    stopBtn.addEventListener("click", () => {
      clearInterval(timerInterval);
      elapsedTime = 0;
      timerDisplay.textContent = "00:00";
      pauseBtn.style.display = "none";
      stopBtn.style.display = "none";
      pauseBtn.textContent = "Pause";
      isPaused = false;
    });
  </script>
</body>
</html>
